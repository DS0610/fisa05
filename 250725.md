# 250725 SQL, pymysql
---
### 정규화
- **중복 데이터**를 **줄이고**, **데이터 무결성**을 **높이기 위한** 데이터베이스 설계 원칙
- 데이터를 **효율적으로 저장**하고, **변경 시 오류 발생 가능성을 줄일 수 있음**

|정규형|목적|조치 내용|장점|
|---|---|---|---|
|1NF|원자값 유지(칸 하나만)|반복값 분리|처리 용이, 검색 정확도 향상|
|2NF|부분 종속 제거(중복되는 것 -> 다른표로)|정보 분리(ex. 수입사, 배급사, 제작사)|중복 제거(저장공간 확보), 무결성 유지|
|3NF|이행적 종속 제거|의미 단위 분리|테이블 의미 명확화|
|4NF|다치 종속 제거|N:M 관계 테이블 분리|관계 명확, 중복 최소화,  관련이 없는 조합 분리|
|5NF|조인 종속 제거(복합키 사용, 때로는 중복을 감수하더라도 서로 다른 필드의 데이터가 정확히 같이 있어야 의미가 있는 경우 정확한 관계를 다시 잘 연결)| 조인 복원 보장| 데이터 정확성, 구조 확장 용이|

### ERD
![ERD 다이어그램 예시](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcScQdg3dxNo5k37wBeWLM1y74fBDSY_1piavQ&s)
- 시스템의 엔티티들이 무엇이 있는지 어떤 관계가 있는지를 나타내는 다이어그램

##### Relationship Cardinality
![관계 표현 기호](https://paperdoll.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fd1a988f4-e527-4f37-84f2-5cf57ae3d75a%2F59c0ace6-0e7b-4eb2-bdbe-616e5b0d5080%2FUntitled.png?table=block&id=239efd73-3489-80f6-991c-f88825f0d0fa&spaceId=d1a988f4-e527-4f37-84f2-5cf57ae3d75a&width=760&userId=&cache=v2)

[ERD CLOUD](https://www.erdcloud.com/)

### pymysql로 DB연결
- pymysql : mysql을 python에서 사용할 수 있는 라이브러리
- mysql 코드 작성 순서
```
  1. 모듈 import
  2. pymysql.connect() 메소드로 MySQL에 연결
     - 호스트명, 포트, 로그인, 암호, 접속할 DB 등을 파라미터로 지정
  3. MySQL 접속이 성공하면, Connection 객체로부터 cursor() 메서드를 호출하여 Cursor 객체를 가져옴
  4. Cursor 객체의 execute() 메서드를 사용하여 SQL 문장을 DB 서버에 전송
  5. SQL 쿼리의 경우 Cursor 객체의 fetchall(), fetchone(), fetchmany() 등의 메서드를 사용하여 서버로부터 가져온 데이타를 코드에서 활용
  6. 삽입, 갱신, 삭제 등의 DML(Data Manipulation Language) 문장을 실행하는 경우, INSERT/UPDATE/DELETE 후 Connection 객체의 commit() 메서드를 사용하여 데이타를 확정
  7. Connection 객체의 close() 메서드를 사용하여 DB 연결을 닫음
```
```
pymysql.connect() 메소드를 사용하여 MySQL에 연결

호스트명, 포트, 로그인, 암호, 접속할 DB 등을 파라미터로 지정
주요 파라미터
host : 접속할 mysql server 주소
port : 접속할 mysql server 의 포트 번호
user : mysql ID
passwd : mysql ID의 암호
db : 접속할 데이터베이스
charset='utf8' : mysql에서 select하여 데이타를 가져올 때 한글이 깨질 수 있으므로 연결 설정에 넣어줌
```

- 데이터 삽입
```
데이터 삽입(INSERT)
Cursor Object 가져오기: cursor = db.cursor()
SQL 실행하기: cursor.execute(SQL)
실행 mysql 서버에 확정 반영하기: db.commit()
```

- 데이터 조회
```
데이터 조회(SELECT)
Cursor Object 가져오기: cursor = db.cursor()
SQL 실행하기: cursor.execute(SQL)
mysql 서버로부터 데이터 가져오기: fetch 메서드 사용
fetchall(): Fetch all the rows
fetchmany(size=None): Fetch several rows
fetchone(): Fetch the next row
```